<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BCFTools, libbcftools and htslib Wrappers and BCF/VCF to Parquet Convertors • RBCFTools</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="BCFTools, libbcftools and htslib Wrappers and BCF/VCF to Parquet Convertors">
<meta name="description" content="Bundles the htslib and bcftools libraries and command lines tools for reading and manipulating VCF/BCF files. Includes streaming facilities from VCF to Apache Arrow via nanoarrow, enabling export to Arrow IPC format and Parquet format using duckdb including a bcf_reader extension. Utilities for reading and writing VCF/BCF files into DuckLake provided.">
<meta property="og:description" content="Bundles the htslib and bcftools libraries and command lines tools for reading and manipulating VCF/BCF files. Includes streaming facilities from VCF to Apache Arrow via nanoarrow, enabling export to Arrow IPC format and Parquet format using duckdb including a bcf_reader extension. Utilities for reading and writing VCF/BCF files into DuckLake provided.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">RBCFTools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.23-0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RGenomicsETL/RBCFTools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="rbcftools">RBCFTools<a class="anchor" aria-label="anchor" href="#rbcftools"></a>
</h1></div>
<!-- badges: start -->

<p>RBCFTools provides R bindings to <a href="https://github.com/samtools/bcftools" class="external-link">bcftools</a> and <a href="https://github.com/samtools/htslib" class="external-link">htslib</a>, the standard tools for reading and manipulating VCF/BCF files. The package bundles these libraries and command-line tools (bcftools, bgzip, tabix), so no external installation is required. When compiled with libcurl, remote file access from S3, GCS, and HTTP URLs is supported. The package also includes support for streaming VCF/BCF to Apache Arrow (IPC) format via <a href="https://arrow.apache.org/nanoarrow/" class="external-link">nanoarrow</a>, with export to Parquet format using <a href="https://duckdb.org/" class="external-link">duckdb</a> via either the <a href="https://duckdb.org/community_extensions/extensions/nanoarrow.html" class="external-link">duckdb nanoarrow extension</a> or a <a href="inst/duckdb_bcf_reader_extension/"><code>bcf_reader</code></a> extension bundled in this package.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of RBCFTools from r-universe for unix-alikes (we do not support windows)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span></span>
<span>    <span class="st">'RBCFTools'</span>,</span>
<span>    repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>              <span class="st">'https://rgenomicsetl.r-universe.dev'</span>,</span>
<span>              <span class="st">'https://cloud.r-project.org'</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="version-information">Version Information<a class="anchor" aria-label="anchor" href="#version-information"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RGenomicsETL/RBCFTools" class="external-link">RBCFTools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span><span class="co"># Get library versions</span></span>
<span><span class="fu"><a href="reference/bcftools_version.html">bcftools_version</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1.23"</span></span>
<span><span class="fu"><a href="reference/htslib_version.html">htslib_version</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1.23"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tool-paths">Tool Paths<a class="anchor" aria-label="anchor" href="#tool-paths"></a>
</h2>
<p>RBCFTools bundles bcftools and htslib command-line tools. Use the path functions to locate the executables</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/bcftools_path.html">bcftools_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/usr/local/lib/R/site-library/RBCFTools/bcftools/bin/bcftools"</span></span>
<span><span class="fu"><a href="reference/bgzip_path.html">bgzip_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/usr/local/lib/R/site-library/RBCFTools/htslib/bin/bgzip"</span></span>
<span><span class="fu"><a href="reference/tabix_path.html">tabix_path</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/usr/local/lib/R/site-library/RBCFTools/htslib/bin/tabix"</span></span>
<span><span class="co"># List all available tools</span></span>
<span><span class="fu"><a href="reference/bcftools_tools.html">bcftools_tools</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "bcftools"        "color-chrs.pl"   "gff2gff"         "gff2gff.py"     </span></span>
<span><span class="co">#&gt;  [5] "guess-ploidy.py" "plot-roh.py"     "plot-vcfstats"   "roh-viz"        </span></span>
<span><span class="co">#&gt;  [9] "run-roh.pl"      "vcfutils.pl"     "vrfs-variances"</span></span>
<span><span class="fu"><a href="reference/htslib_tools.html">htslib_tools</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "annot-tsv" "bgzip"     "htsfile"   "ref-cache" "tabix"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="capabilities">Capabilities<a class="anchor" aria-label="anchor" href="#capabilities"></a>
</h2>
<p>Check which features were compiled into htslib</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all capabilities as a named list</span></span>
<span><span class="fu"><a href="reference/htslib_capabilities.html">htslib_capabilities</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $configure</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $plugins</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $libcurl</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $s3</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gcs</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $libdeflate</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lzma</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bzip2</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $htscodecs</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Human-readable feature string</span></span>
<span><span class="fu"><a href="reference/htslib_feature_string.html">htslib_feature_string</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "build=configure libcurl=yes S3=yes GCS=yes libdeflate=yes lzma=yes bzip2=yes plugins=yes plugin-path=/usr/local/lib/R/site-library/RBCFTools/htslib/libexec/htslib: htscodecs=1.6.5"</span></span></code></pre></div>
<div class="section level3">
<h3 id="feature-constants">Feature Constants<a class="anchor" aria-label="anchor" href="#feature-constants"></a>
</h3>
<p>Use <code>HTS_FEATURE_*</code> constants to check for specific features</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check individual features</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_LIBCURL</span><span class="op">)</span>  <span class="co"># Remote file access via libcurl</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_S3</span><span class="op">)</span>       </span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_GCS</span><span class="op">)</span>      <span class="co"># Google Cloud Storage</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_LIBDEFLATE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_LZMA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="reference/htslib_has_feature.html">htslib_has_feature</a></span><span class="op">(</span><span class="va">HTS_FEATURE_BZIP2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>These are useful for conditionally enabling features in your code.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-query-of-remote-vcf-from-s3-using-bcftools">Example Query Of Remote VCF from S3 using bcftools<a class="anchor" aria-label="anchor" href="#example-query-of-remote-vcf-from-s3-using-bcftools"></a>
</h2>
<p>With libcurl support, bcftools can directly query remote files. Here we count variants in a small region from the 1000 Genomes cohort VCF on S3:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup environment for remote file access (S3/GCS)</span></span>
<span><span class="fu"><a href="reference/setup_hts_env.html">setup_hts_env</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build S3 URL for 1000 Genomes cohort VCF</span></span>
<span><span class="va">s3_base</span> <span class="op">&lt;-</span> <span class="st">"s3://1000genomes-dragen-v3.7.6/data/cohorts/"</span></span>
<span><span class="va">s3_path</span> <span class="op">&lt;-</span> <span class="st">"gvcf-genotyper-dragen-3.7.6/hg19/3202-samples-cohort/"</span></span>
<span><span class="va">s3_vcf_file</span> <span class="op">&lt;-</span> <span class="st">"3202_samples_cohort_gg_chr22.vcf.gz"</span></span>
<span><span class="va">s3_vcf_uri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">s3_base</span>, <span class="va">s3_path</span>, <span class="va">s3_vcf_file</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use processx instead of system2</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/bcftools_path.html">bcftools_path</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"index"</span>, <span class="st">"-n"</span>, <span class="va">s3_vcf_uri</span><span class="op">)</span>,</span>
<span>  error_on_status <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">stdou</span></span>
<span><span class="co">#&gt; [1] "1910766\n"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="vcf-to-arrow-streams-and-duckdb-bcf_reader-extension">VCF to Arrow Streams and Duckdb <code>bcf_reader</code> extension<a class="anchor" aria-label="anchor" href="#vcf-to-arrow-streams-and-duckdb-bcf_reader-extension"></a>
</h2>
<p>RBCFTools provides streaming VCF/BCF to Apache Arrow Stream conversion via <a href="https://arrow.apache.org/nanoarrow/" class="external-link">nanoarrow</a>. This enables integration with tools like <a href="https://github.com/duckdb/duckdb-r" class="external-link">duckdb</a> and Parquet format convertion when serializing to Arrow IPC. We also support the <a href="inst/duckdb_bcf_reader_extension/"><code>bcf_reader</code></a> duckdb extension to read directly into duckb.</p>
<p>The <code>nanoarrow</code> stream conversion and <code>bcf_reader</code> perform VCF spec conformance checks on headers (similar to htslib’s <code>bcf_hdr_check_sanity()</code>) and emits R warning or duckdb logs when correcting non-conformant fields</p>
<div class="section level3">
<h3 id="read-vcf-as-arrow-stream">Read VCF as Arrow Stream<a class="anchor" aria-label="anchor" href="#read-vcf-as-arrow-stream"></a>
</h3>
<p>Open BCF as Arrow array stream and read the batches</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">bcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.bcf"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_arrow.html">vcf_open_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, batch_size <span class="op">=</span> <span class="fl">100L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="va">stream</span><span class="op">$</span><span class="fu">get_next</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/AD should be declared as Number=R per VCF</span></span>
<span><span class="co">#&gt; spec; correcting schema</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/GQ should be Type=Integer per VCF spec, but</span></span>
<span><span class="co">#&gt; header declares Type=Float; using header type</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/GT should be declared as Number=1 per VCF</span></span>
<span><span class="co">#&gt; spec; correcting schema</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/AD should be declared as Number=R per VCF</span></span>
<span><span class="co">#&gt; spec; correcting schema</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/GQ should be Type=Integer per VCF spec, but</span></span>
<span><span class="co">#&gt; header declares Type=Float; using header type</span></span>
<span><span class="co">#&gt; Warning in x$get_schema(): FORMAT/GT should be declared as Number=1 per VCF</span></span>
<span><span class="co">#&gt; spec; correcting schema</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/convert_array.html" class="external-link">convert_array</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS         ID REF ALT QUAL FILTER INFO.DP INFO.AF       INFO.CB</span></span>
<span><span class="co">#&gt; 1     1 10583 rs58108140   G   A   NA   PASS    1557   0.162 UM,BI,BC,NCBI</span></span>
<span><span class="co">#&gt; 2     1 11508       &lt;NA&gt;   A   G   NA   PASS      23    0.72         BI,BC</span></span>
<span><span class="co">#&gt; 3     1 11565       &lt;NA&gt;   G   T   NA   PASS      45       0         BI,BC</span></span>
<span><span class="co">#&gt; 4     1 13116       &lt;NA&gt;   T   G   NA   PASS    2400   0.016         UM,BI</span></span>
<span><span class="co">#&gt; 5     1 13327       &lt;NA&gt;   G   C   NA   PASS    2798    0.01         BI,BC</span></span>
<span><span class="co">#&gt; 6     1 14699       &lt;NA&gt;   C   G   NA   PASS     408    0.02         BI,BC</span></span>
<span><span class="co">#&gt;   INFO.EUR_R2 INFO.AFR_R2 INFO.ASN_R2 INFO.AC INFO.AN samples.HG00098.AD</span></span>
<span><span class="co">#&gt; 1       0.248          NA          NA       0       6               NULL</span></span>
<span><span class="co">#&gt; 2       0.001          NA          NA       6       6               NULL</span></span>
<span><span class="co">#&gt; 3          NA       0.003          NA       0       6               NULL</span></span>
<span><span class="co">#&gt; 4       0.106       0.286          NA       0       6               NULL</span></span>
<span><span class="co">#&gt; 5       0.396       0.481          NA       0       6               NULL</span></span>
<span><span class="co">#&gt; 6       0.061       0.184          NA       0       6               NULL</span></span>
<span><span class="co">#&gt;   samples.HG00098.DP samples.HG00098.GL samples.HG00098.GQ samples.HG00098.GT</span></span>
<span><span class="co">#&gt; 1                 NA               NULL               3.28                0|0</span></span>
<span><span class="co">#&gt; 2                 NA               NULL               2.22                1|1</span></span>
<span><span class="co">#&gt; 3                 NA               NULL               1.48                0|0</span></span>
<span><span class="co">#&gt; 4                 NA               NULL               9.17                0|0</span></span>
<span><span class="co">#&gt; 5                 NA               NULL              15.80                0|0</span></span>
<span><span class="co">#&gt; 6                 NA               NULL               6.29                0|0</span></span>
<span><span class="co">#&gt;   samples.HG00098.GD samples.HG00098.OG samples.HG00100.AD samples.HG00100.DP</span></span>
<span><span class="co">#&gt; 1                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt; 2                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt; 3                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt; 4                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt; 5                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt; 6                 NA                ./.               NULL                 NA</span></span>
<span><span class="co">#&gt;   samples.HG00100.GL samples.HG00100.GQ samples.HG00100.GT samples.HG00100.GD</span></span>
<span><span class="co">#&gt; 1               NULL               3.28                0|0                 NA</span></span>
<span><span class="co">#&gt; 2               NULL               2.22                1|1                 NA</span></span>
<span><span class="co">#&gt; 3               NULL               1.48                0|0                 NA</span></span>
<span><span class="co">#&gt; 4               NULL               9.17                0|0                 NA</span></span>
<span><span class="co">#&gt; 5               NULL              15.80                0|0                 NA</span></span>
<span><span class="co">#&gt; 6               NULL               6.29                0|0                 NA</span></span>
<span><span class="co">#&gt;   samples.HG00100.OG samples.HG00106.AD samples.HG00106.DP samples.HG00106.GL</span></span>
<span><span class="co">#&gt; 1                ./.               NULL                 NA               NULL</span></span>
<span><span class="co">#&gt; 2                ./.               NULL                 NA               NULL</span></span>
<span><span class="co">#&gt; 3                ./.               NULL                 NA               NULL</span></span>
<span><span class="co">#&gt; 4                ./.               NULL                 NA               NULL</span></span>
<span><span class="co">#&gt; 5                ./.               2, 0                  2 0.00, -0.60, -8.78</span></span>
<span><span class="co">#&gt; 6                ./.               NULL                 NA               NULL</span></span>
<span><span class="co">#&gt;   samples.HG00106.GQ samples.HG00106.GT samples.HG00106.GD samples.HG00106.OG</span></span>
<span><span class="co">#&gt; 1               3.28                0|0                 NA                ./.</span></span>
<span><span class="co">#&gt; 2               2.22                1|1                 NA                ./.</span></span>
<span><span class="co">#&gt; 3               1.48                0|0                 NA                ./.</span></span>
<span><span class="co">#&gt; 4               9.17                0|0                 NA                ./.</span></span>
<span><span class="co">#&gt; 5              21.74                0|0                 NA                ./.</span></span>
<span><span class="co">#&gt; 6               6.29                0|0                 NA                ./.</span></span>
<span><span class="va">stream</span><span class="op">$</span><span class="fu">release</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="convert-to-data-frame">Convert to Data Frame<a class="anchor" aria-label="anchor" href="#convert-to-data-frame"></a>
</h3>
<p>Convert entire BCF to data.frame</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>  <span class="co"># Suppress warnings</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_to_arrow.html">vcf_to_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, as <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span>, <span class="st">"ALT"</span>, <span class="st">"QUAL"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT QUAL</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A   NA</span></span>
<span><span class="co">#&gt; 2     1 11508   A   G   NA</span></span>
<span><span class="co">#&gt; 3     1 11565   G   T   NA</span></span>
<span><span class="co">#&gt; 4     1 13116   T   G   NA</span></span>
<span><span class="co">#&gt; 5     1 13327   G   C   NA</span></span>
<span><span class="co">#&gt; 6     1 14699   C   G   NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-to-arrow-ipc">Write to Arrow IPC<a class="anchor" aria-label="anchor" href="#write-to-arrow-ipc"></a>
</h3>
<p>Arrow IPC (<code>.arrows</code>) format for interoperability with other Arrow tools using nanoarrow’s native streaming writer</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Convert BCF to Arrow IPC</span></span>
<span><span class="va">ipc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".arrows"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/vcf_to_arrow_ipc.html">vcf_to_arrow_ipc</a></span><span class="op">(</span><span class="va">bcf_file</span>, <span class="va">ipc_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read back with nanoarrow</span></span>
<span><span class="va">ipc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/read_nanoarrow.html" class="external-link">read_nanoarrow</a></span><span class="op">(</span><span class="va">ipc_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ipc_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span>, <span class="st">"ALT"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A</span></span>
<span><span class="co">#&gt; 2     1 11508   A   G</span></span>
<span><span class="co">#&gt; 3     1 11565   G   T</span></span>
<span><span class="co">#&gt; 4     1 13116   T   G</span></span>
<span><span class="co">#&gt; 5     1 13327   G   C</span></span>
<span><span class="co">#&gt; 6     1 14699   C   G</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-vcf-streams-to-parquet">Write VCF Streams to Parquet<a class="anchor" aria-label="anchor" href="#write-vcf-streams-to-parquet"></a>
</h3>
<p>Using <a href="https://github.com/duckdb/duckdb-r" class="external-link">duckdb</a> to convert BCF to parquet file and perform queries on the parquet file. This involve vcf stream conversion to data.frame</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">parquet_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/vcf_to_parquet_arrow.html">vcf_to_parquet_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, <span class="va">parquet_file</span>, compression <span class="op">=</span> <span class="st">"snappy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote 11 rows to /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pq_bcf</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT * FROM '%s' LIMIT 100"</span>, <span class="va">parquet_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pq_me</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span></span>
<span>    <span class="va">con</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT * FROM parquet_metadata('%s')"</span>,</span>
<span>    <span class="va">parquet_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbDisconnect</span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pq_bcf</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span>, <span class="st">"ALT"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A</span></span>
<span><span class="co">#&gt; 2     1 11508   A   G</span></span>
<span><span class="co">#&gt; 3     1 11565   G   T</span></span>
<span><span class="co">#&gt; 4     1 13116   T   G</span></span>
<span><span class="co">#&gt; 5     1 13327   G   C</span></span>
<span><span class="co">#&gt; 6     1 14699   C   G</span></span>
<span><span class="va">pq_me</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   file_name row_group_id row_group_num_rows</span></span>
<span><span class="co">#&gt; 1 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt; 2 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt; 3 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt; 4 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt; 5 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt; 6 /tmp/RtmpanmlwP/file2cb1d75fde1dc.parquet            0                 11</span></span>
<span><span class="co">#&gt;   row_group_num_columns row_group_bytes column_id file_offset num_values</span></span>
<span><span class="co">#&gt; 1                    36            3135         0           0         11</span></span>
<span><span class="co">#&gt; 2                    36            3135         1           0         11</span></span>
<span><span class="co">#&gt; 3                    36            3135         2           0         11</span></span>
<span><span class="co">#&gt; 4                    36            3135         3           0         11</span></span>
<span><span class="co">#&gt; 5                    36            3135         4           0         11</span></span>
<span><span class="co">#&gt; 6                    36            3135         5           0         11</span></span>
<span><span class="co">#&gt;       path_in_schema       type  stats_min  stats_max stats_null_count</span></span>
<span><span class="co">#&gt; 1              CHROM BYTE_ARRAY          1          1                0</span></span>
<span><span class="co">#&gt; 2                POS     DOUBLE    10583.0    28376.0                0</span></span>
<span><span class="co">#&gt; 3                 ID BYTE_ARRAY rs58108140 rs58108140               10</span></span>
<span><span class="co">#&gt; 4                REF BYTE_ARRAY          A          T                0</span></span>
<span><span class="co">#&gt; 5 ALT, list, element BYTE_ARRAY          A          T               NA</span></span>
<span><span class="co">#&gt; 6               QUAL     DOUBLE       &lt;NA&gt;       &lt;NA&gt;               11</span></span>
<span><span class="co">#&gt;   stats_distinct_count stats_min_value stats_max_value compression</span></span>
<span><span class="co">#&gt; 1                    1               1               1      SNAPPY</span></span>
<span><span class="co">#&gt; 2                   NA         10583.0         28376.0      SNAPPY</span></span>
<span><span class="co">#&gt; 3                    1      rs58108140      rs58108140      SNAPPY</span></span>
<span><span class="co">#&gt; 4                   NA               A               T      SNAPPY</span></span>
<span><span class="co">#&gt; 5                   NA               A               T      SNAPPY</span></span>
<span><span class="co">#&gt; 6                   NA            &lt;NA&gt;            &lt;NA&gt;      SNAPPY</span></span>
<span><span class="co">#&gt;          encodings index_page_offset dictionary_page_offset data_page_offset</span></span>
<span><span class="co">#&gt; 1 PLAIN_DICTIONARY                NA                      4               24</span></span>
<span><span class="co">#&gt; 2            PLAIN                NA                     NA               52</span></span>
<span><span class="co">#&gt; 3 PLAIN_DICTIONARY                NA                    146              175</span></span>
<span><span class="co">#&gt; 4            PLAIN                NA                     NA              208</span></span>
<span><span class="co">#&gt; 5            PLAIN                NA                     NA              268</span></span>
<span><span class="co">#&gt; 6            PLAIN                NA                     NA              335</span></span>
<span><span class="co">#&gt;   total_compressed_size total_uncompressed_size key_value_metadata</span></span>
<span><span class="co">#&gt; 1                    48                      44               NULL</span></span>
<span><span class="co">#&gt; 2                    94                     113               NULL</span></span>
<span><span class="co">#&gt; 3                    62                      84               NULL</span></span>
<span><span class="co">#&gt; 4                    60                      78               NULL</span></span>
<span><span class="co">#&gt; 5                    67                      85               NULL</span></span>
<span><span class="co">#&gt; 6                    25                      23               NULL</span></span>
<span><span class="co">#&gt;   bloom_filter_offset bloom_filter_length min_is_exact max_is_exact</span></span>
<span><span class="co">#&gt; 1                2261                  47         TRUE         TRUE</span></span>
<span><span class="co">#&gt; 2                  NA                  NA         TRUE         TRUE</span></span>
<span><span class="co">#&gt; 3                2308                  47         TRUE         TRUE</span></span>
<span><span class="co">#&gt; 4                  NA                  NA         TRUE         TRUE</span></span>
<span><span class="co">#&gt; 5                  NA                  NA         TRUE         TRUE</span></span>
<span><span class="co">#&gt; 6                  NA                  NA           NA           NA</span></span>
<span><span class="co">#&gt;   row_group_compressed_bytes geo_bbox.xmin geo_bbox.xmax geo_bbox.ymin</span></span>
<span><span class="co">#&gt; 1                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt; 2                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt; 3                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt; 4                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt; 5                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt; 6                          1            NA            NA            NA</span></span>
<span><span class="co">#&gt;   geo_bbox.ymax geo_bbox.zmin geo_bbox.zmax geo_bbox.mmin geo_bbox.mmax</span></span>
<span><span class="co">#&gt; 1            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt; 2            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt; 3            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt; 4            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt; 5            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt; 6            NA            NA            NA            NA            NA</span></span>
<span><span class="co">#&gt;   geo_types</span></span>
<span><span class="co">#&gt; 1      NULL</span></span>
<span><span class="co">#&gt; 2      NULL</span></span>
<span><span class="co">#&gt; 3      NULL</span></span>
<span><span class="co">#&gt; 4      NULL</span></span>
<span><span class="co">#&gt; 5      NULL</span></span>
<span><span class="co">#&gt; 6      NULL</span></span></code></pre></div>
<p>Use <code>streaming = TRUE</code> to avoid loading the entire VCF into R memory. This streams VCF to Arrow IPC (nanoarrow) and then to Parquet via duckdb, trading memory with serialization overhead using the <a href="https://duckdb.org/community_extensions/extensions/nanoarrow.html" class="external-link">duckdb nanoarrow extension</a></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bcf_larger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G.ALL.2of4intersection.20100804.genotypes.bcf"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">outfile</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/vcf_to_parquet_arrow.html">vcf_to_parquet_arrow</a></span><span class="op">(</span></span>
<span>    <span class="va">bcf_larger</span>,</span>
<span>    <span class="va">outfile</span>,</span>
<span>    streaming <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">10000L</span>,</span>
<span>    row_group_size <span class="op">=</span> <span class="fl">100000L</span>,</span>
<span>    compression <span class="op">=</span> <span class="st">"zstd"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote 11 rows to /tmp/RtmpanmlwP/file2cb1df49aca3.parquet (streaming mode)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="query-vcf-with-duckdb-after-converting-the-stream">Query VCF with duckdb after converting the Stream<a class="anchor" aria-label="anchor" href="#query-vcf-with-duckdb-after-converting-the-stream"></a>
</h3>
<p>SQL queries on BCF using duckdb package. For now this is somehow limited due to convertion from arrow streams to data frame</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/vcf_query_arrow.html">vcf_query_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, <span class="st">"SELECT CHROM, COUNT(*) as n FROM vcf GROUP BY CHROM"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM  n</span></span>
<span><span class="co">#&gt; 1     1 11</span></span>
<span></span>
<span><span class="co"># Filter variants by position</span></span>
<span><span class="fu"><a href="reference/vcf_query_arrow.html">vcf_query_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, <span class="st">"SELECT CHROM, POS, REF, ALT FROM vcf  LIMIT 5"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A</span></span>
<span><span class="co">#&gt; 2     1 11508   A   G</span></span>
<span><span class="co">#&gt; 3     1 11565   G   T</span></span>
<span><span class="co">#&gt; 4     1 13116   T   G</span></span>
<span><span class="co">#&gt; 5     1 13327   G   C</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="query-vcf-with-duckdb-extension">Query VCF with DuckDB Extension<a class="anchor" aria-label="anchor" href="#query-vcf-with-duckdb-extension"></a>
</h3>
<p>A native DuckDB extension (<code>bcf_reader</code>) for direct SQL queries on VCF/BCF files without Arrow conversion overhead. The extension uses the Duckb C API and should be compatible with duckb v1.2.0+</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build extension (uses package's bundled htslib)</span></span>
<span><span class="va">build_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"bcf_reader"</span><span class="op">)</span></span>
<span><span class="va">ext_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bcf_reader_build.html">bcf_reader_build</a></span><span class="op">(</span><span class="va">build_dir</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect and query a VCF.gz file</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_duckdb_connect.html">vcf_duckdb_connect</a></span><span class="op">(</span><span class="va">ext_path</span><span class="op">)</span></span>
<span><span class="va">vcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_deep_variant.vcf.gz"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Describe schema</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"DESCRIBE SELECT * FROM bcf_read('%s')"</span>, <span class="va">vcf_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        column_name column_type null  key default extra</span></span>
<span><span class="co">#&gt; 1                            CHROM     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2                              POS      BIGINT  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                               ID     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4                              REF     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5                              ALT   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6                             QUAL      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7                           FILTER   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8                         INFO_END     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9      FORMAT_GT_test_deep_variant     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10     FORMAT_GQ_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11     FORMAT_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 FORMAT_MIN_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13     FORMAT_AD_test_deep_variant   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14    FORMAT_VAF_test_deep_variant     FLOAT[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15     FORMAT_PL_test_deep_variant   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16 FORMAT_MED_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span></span>
<span><span class="co"># Aggregate query</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  SELECT CHROM, COUNT(*) as n_variants, </span></span>
<span><span class="st">         MIN(POS) as min_pos, MAX(POS) as max_pos</span></span>
<span><span class="st">  FROM bcf_read('%s') </span></span>
<span><span class="st">  GROUP BY CHROM </span></span>
<span><span class="st">  ORDER BY n_variants DESC </span></span>
<span><span class="st">  LIMIT 5"</span>, <span class="va">vcf_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM n_variants min_pos   max_pos</span></span>
<span><span class="co">#&gt; 1    19      35918  111129  59084689</span></span>
<span><span class="co">#&gt; 2     1      35846  536895 249211717</span></span>
<span><span class="co">#&gt; 3    17      27325    6102  81052229</span></span>
<span><span class="co">#&gt; 4    11      24472  180184 134257519</span></span>
<span><span class="co">#&gt; 5     2      22032   42993 242836470</span></span>
<span></span>
<span><span class="co"># Export directly to Parquet</span></span>
<span><span class="va">parquet_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  COPY (SELECT * FROM bcf_read('%s')) </span></span>
<span><span class="st">  TO '%s' (FORMAT PARQUET, COMPRESSION ZSTD)"</span>, <span class="va">vcf_file</span>, <span class="va">parquet_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 368319</span></span>
<span></span>
<span><span class="co"># Verify parquet file size</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.info</a></span><span class="op">(</span><span class="va">parquet_out</span><span class="op">)</span><span class="op">$</span><span class="va">size</span></span>
<span><span class="co">#&gt; [1] 3998815</span></span>
<span></span>
<span><span class="co"># Same query on Parquet file</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  SELECT CHROM, COUNT(*) as n_variants, </span></span>
<span><span class="st">         MIN(POS) as min_pos, MAX(POS) as max_pos</span></span>
<span><span class="st">  FROM '%s' </span></span>
<span><span class="st">  GROUP BY CHROM </span></span>
<span><span class="st">  ORDER BY n_variants DESC </span></span>
<span><span class="st">  LIMIT 5"</span>, <span class="va">parquet_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM n_variants min_pos   max_pos</span></span>
<span><span class="co">#&gt; 1    19      35918  111129  59084689</span></span>
<span><span class="co">#&gt; 2     1      35846  536895 249211717</span></span>
<span><span class="co">#&gt; 3    17      27325    6102  81052229</span></span>
<span><span class="co">#&gt; 4    11      24472  180184 134257519</span></span>
<span><span class="co">#&gt; 5     2      22032   42993 242836470</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="open-vcf-as-duckdb-tableview">Open VCF as DuckDB Table/View<a class="anchor" aria-label="anchor" href="#open-vcf-as-duckdb-tableview"></a>
</h3>
<p>The <code><a href="reference/vcf_open_duckdb.html">vcf_open_duckdb()</a></code> function provides a convenient interface to open VCF/BCF files as DuckDB tables or views, similar to <code><a href="reference/vcf_open_arrow.html">vcf_open_arrow()</a></code> for Arrow streams. By default it creates a <strong>lazy view</strong> that reads from the VCF on each query - instant to create with no memory overhead.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build extension</span></span>
<span><span class="va">ext_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bcf_reader_build.html">bcf_reader_build</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.vcf.gz"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open as lazy view (default) - instant creation</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_duckdb.html">vcf_open_duckdb</a></span><span class="op">(</span><span class="va">vcf_file</span>, <span class="va">ext_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Created view 'variants' from 1000G_3samples.vcf.gz</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; VCF DuckDB Connection</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Source file: 1000G_3samples.vcf.gz </span></span>
<span><span class="co">#&gt; Table name:  variants </span></span>
<span><span class="co">#&gt; Type:        VIEW (lazy) </span></span>
<span><span class="co">#&gt; Database:    in-memory </span></span>
<span><span class="co">#&gt; Tidy format: FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use DBI::dbGetQuery(vcf$con, 'SELECT ...') to query</span></span>
<span><span class="co">#&gt; Use vcf_close_duckdb(vcf) when done</span></span>
<span></span>
<span><span class="co"># Query the view</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">$</span><span class="va">con</span>, <span class="st">"SELECT CHROM, POS, REF, ALT FROM variants LIMIT 5"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A</span></span>
<span><span class="co">#&gt; 2     1 11508   A   G</span></span>
<span><span class="co">#&gt; 3     1 11565   G   T</span></span>
<span><span class="co">#&gt; 4     1 13116   T   G</span></span>
<span><span class="co">#&gt; 5     1 13327   G   C</span></span>
<span></span>
<span><span class="co"># Close connection</span></span>
<span><span class="fu"><a href="reference/vcf_close_duckdb.html">vcf_close_duckdb</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span></code></pre></div>
<p>For repeated queries on the same data, materialize to a table with <code>as_view = FALSE</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Materialize to in-memory table (slower to create, fast queries)</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_duckdb.html">vcf_open_duckdb</a></span><span class="op">(</span><span class="va">vcf_file</span>, <span class="va">ext_path</span>, as_view <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Created table 'variants' with 11 rows from 1000G_3samples.vcf.gz</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; VCF DuckDB Connection</span></span>
<span><span class="co">#&gt; ---------------------</span></span>
<span><span class="co">#&gt; Source file: 1000G_3samples.vcf.gz </span></span>
<span><span class="co">#&gt; Table name:  variants </span></span>
<span><span class="co">#&gt; Type:        TABLE (materialized) </span></span>
<span><span class="co">#&gt; Database:    in-memory </span></span>
<span><span class="co">#&gt; Tidy format: FALSE </span></span>
<span><span class="co">#&gt; Row count:   11 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use DBI::dbGetQuery(vcf$con, 'SELECT ...') to query</span></span>
<span><span class="co">#&gt; Use vcf_close_duckdb(vcf) when done</span></span>
<span></span>
<span><span class="co"># Multiple fast queries on materialized data</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">$</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) as n FROM variants"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    n</span></span>
<span><span class="co">#&gt; 1 11</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">$</span><span class="va">con</span>, <span class="st">"SELECT CHROM, COUNT(*) as n FROM variants GROUP BY CHROM"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM  n</span></span>
<span><span class="co">#&gt; 1     1 11</span></span>
<span></span>
<span><span class="fu"><a href="reference/vcf_close_duckdb.html">vcf_close_duckdb</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span></code></pre></div>
<p>For large VCF files, use tidy format and parallel loading:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tidy format with column selection</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_duckdb.html">vcf_open_duckdb</a></span><span class="op">(</span></span>
<span>  <span class="va">vcf_file</span>, <span class="va">ext_path</span>,</span>
<span>  tidy_format <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span>, <span class="st">"ALT"</span>, <span class="st">"SAMPLE_ID"</span>, <span class="st">"FORMAT_GT"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Created view 'variants' from 1000G_3samples.vcf.gz</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">$</span><span class="va">con</span>, <span class="st">"SELECT * FROM variants LIMIT 6"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF ALT SAMPLE_ID FORMAT_GT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   A   HG00098       0|0</span></span>
<span><span class="co">#&gt; 2     1 10583   G   A   HG00100       0|0</span></span>
<span><span class="co">#&gt; 3     1 10583   G   A   HG00106       0|0</span></span>
<span><span class="co">#&gt; 4     1 11508   A   G   HG00098       1|1</span></span>
<span><span class="co">#&gt; 5     1 11508   A   G   HG00100       1|1</span></span>
<span><span class="co">#&gt; 6     1 11508   A   G   HG00106       1|1</span></span>
<span><span class="fu"><a href="reference/vcf_close_duckdb.html">vcf_close_duckdb</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tidy-long-format-export">Tidy (Long) Format Export<a class="anchor" aria-label="anchor" href="#tidy-long-format-export"></a>
</h3>
<p>Export VCF/BCF to a “tidy” format where each row is one variant-sample combination. The native <code>tidy_format</code> parameter in the bcf_reader extension transforms wide <code>FORMAT_&lt;field&gt;_&lt;sample&gt;</code> columns into a single <code>SAMPLE_ID</code> column plus <code>FORMAT_&lt;field&gt;</code> columns - much faster than SQL-level UNNEST.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build extension</span></span>
<span><span class="va">ext_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bcf_reader_build.html">bcf_reader_build</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Multi-sample VCF: 3 samples x 11 variants = 33 rows</span></span>
<span><span class="va">vcf_3samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.vcf.gz"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">tidy_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use tidy_format parameter directly</span></span>
<span><span class="fu"><a href="reference/vcf_to_parquet_duckdb.html">vcf_to_parquet_duckdb</a></span><span class="op">(</span><span class="va">vcf_3samples</span>, <span class="va">tidy_out</span>, extension_path <span class="op">=</span> <span class="va">ext_path</span>, tidy_format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote: /tmp/RtmpanmlwP/file2cb1d44245124.parquet</span></span>
<span></span>
<span><span class="co"># Query the tidy output</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  SELECT CHROM, POS, REF, SAMPLE_ID, FORMAT_GT </span></span>
<span><span class="st">  FROM '%s' </span></span>
<span><span class="st">  LIMIT 9"</span>, <span class="va">tidy_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF SAMPLE_ID FORMAT_GT</span></span>
<span><span class="co">#&gt; 1     1 10583   G   HG00098       0|0</span></span>
<span><span class="co">#&gt; 2     1 10583   G   HG00100       0|0</span></span>
<span><span class="co">#&gt; 3     1 10583   G   HG00106       0|0</span></span>
<span><span class="co">#&gt; 4     1 11508   A   HG00098       1|1</span></span>
<span><span class="co">#&gt; 5     1 11508   A   HG00100       1|1</span></span>
<span><span class="co">#&gt; 6     1 11508   A   HG00106       1|1</span></span>
<span><span class="co">#&gt; 7     1 11565   G   HG00098       0|0</span></span>
<span><span class="co">#&gt; 8     1 11565   G   HG00100       0|0</span></span>
<span><span class="co">#&gt; 9     1 11565   G   HG00106       0|0</span></span>
<span></span>
<span><span class="co"># Verify row expansion: variants * samples</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  SELECT COUNT(*) as total_rows, </span></span>
<span><span class="st">         COUNT(DISTINCT SAMPLE_ID) as n_samples</span></span>
<span><span class="st">  FROM '%s'"</span>, <span class="va">tidy_out</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   total_rows n_samples</span></span>
<span><span class="co">#&gt; 1         33         3</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This format is ideal for combining single-sample VCFs into cohort tables or appending to DuckLake tables with MERGE operations.</p>
</div>
<div class="section level3">
<h3 id="vcf-header-metadata-in-parquet">VCF Header Metadata in Parquet<a class="anchor" aria-label="anchor" href="#vcf-header-metadata-in-parquet"></a>
</h3>
<p>When exporting VCF to Parquet, the full VCF header is embedded as Parquet key-value metadata by default. This preserves all schema information (INFO, FORMAT, FILTER definitions, contigs, samples) enabling round-trip back to VCF format.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build extension</span></span>
<span><span class="va">ext_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bcf_reader_build.html">bcf_reader_build</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">vcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.vcf.gz"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export with embedded VCF header (default)</span></span>
<span><span class="va">parquet_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/vcf_to_parquet_duckdb.html">vcf_to_parquet_duckdb</a></span><span class="op">(</span><span class="va">vcf_file</span>, <span class="va">parquet_out</span>, <span class="va">ext_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote: /tmp/RtmpanmlwP/file2cb1d19020191.parquet</span></span>
<span></span>
<span><span class="co"># Read back the metadata</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/parquet_kv_metadata.html">parquet_kv_metadata</a></span><span class="op">(</span><span class="va">parquet_out</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 key</span></span>
<span><span class="co">#&gt; 1        vcf_header</span></span>
<span><span class="co">#&gt; 2 RBCFTools_version</span></span>
<span><span class="co">#&gt; 3       tidy_format</span></span>
<span><span class="co">#&gt;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       value</span></span>
<span><span class="co">#&gt; 1 ##fileformat=VCFv4.0\\x0A##FILTER=&lt;ID=PASS,Description=\\x22All filters passed\\x22&gt;\\x0A##filedat=20101112\\x0A##datarelease=20100804\\x0A##samples=629\\x0A##contig=&lt;ID=1,length=249250621&gt;\\x0A##description=\\x22Where BI calls are present, genotypes and alleles are from BI.  In there absence, UM genotypes are used.  If neither are available, no genotype information is present and the alleles are from the NCBI calls.\\x22\\x0A##FORMAT=&lt;ID=AD,Number=A,Type=Integer,Description=\\x22Allelic depths for the ref and alt alleles in the order listed\\x22&gt;\\x0A##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description=\\x22Read Depth (only filtered reads used for calling)\\x22&gt;\\x0A##FORMAT=&lt;ID=GL,Number=G,Type=Float,Description=\\x22Log-scaled likelihoods for AA,AB,BB genotypes where A=ref and B=alt; not applicable if site is not biallelic\\x22&gt;\\x0A##FORMAT=&lt;ID=GQ,Number=1,Type=Float,Description=\\x22Genotype Quality\\x22&gt;\\x0A##FORMAT=&lt;ID=GT,Number=A,Type=String,Description=\\x22Genotype\\x22&gt;\\x0A##FORMAT=&lt;ID=GD,Number=1,Type=Float,Description=\\x22Genotype dosage.  Expected count of non-ref alleles [0,2]\\x22&gt;\\x0A##FORMAT=&lt;ID=OG,Number=1,Type=String,Description=\\x22Original Genotype input to Beagle\\x22&gt;\\x0A##INFO=&lt;ID=AF,Number=.,Type=Float,Description=\\x22Allele Frequency, for each ALT allele, in the same order as listed\\x22&gt;\\x0A##INFO=&lt;ID=DP,Number=1,Type=Integer,Description=\\x22Total Depth\\x22&gt;\\x0A##INFO=&lt;ID=CB,Number=.,Type=String,Description=\\x22List of centres that called, UM (University of Michigan), BI (Broad Institute), BC (Boston College), NCBI\\x22&gt;\\x0A##INFO=&lt;ID=EUR_R2,Number=1,Type=Float,Description=\\x22R2 From Beagle based on European Samples\\x22&gt;\\x0A##INFO=&lt;ID=AFR_R2,Number=1,Type=Float,Description=\\x22R2 From Beagle based on AFRICAN Samples\\x22&gt;\\x0A##INFO=&lt;ID=ASN_R2,Number=1,Type=Float,Description=\\x22R2 From Beagle based on Asian Samples\\x22&gt;\\x0A##bcftools_viewVersion=1.9-321-g5774f32+htslib-1.10.2-22-gbfc9f0d\\x0A##bcftools_viewCommand=view -O b -o 1000G.ALL.2of4intersection.20100804.genotypes.bcf 1000G.ALL.2of4intersection.20100804.genotypes.vcf; Date=Fri Apr 24 20:53:38 2020\\x0A##INFO=&lt;ID=AC,Number=A,Type=Integer,Description=\\x22Allele count in genotypes\\x22&gt;\\x0A##INFO=&lt;ID=AN,Number=1,Type=Integer,Description=\\x22Total number of alleles in called genotypes\\x22&gt;\\x0A##bcftools_viewVersion=1.23+htslib-1.23\\x0A##bcftools_viewCommand=view -s HG00098,HG00100,HG00106 -O b -o inst/extdata/1000G_3samples.bcf inst/extdata/1000G.ALL.2of4intersection.20100804.genotypes.bcf; Date=Sat Jan  3 14:41:16 2026\\x0A##bcftools_viewCommand=view -O z -o 1000G_3samples.vcf.gz 1000G_3samples.bcf; Date=Wed Jan  7 14:39:56 2026\\x0A##bcftools_viewCommand=view -h /usr/local/lib/R/site-library/RBCFTools/extdata/1000G_3samples.vcf.gz; Date=Thu Jan 15 01:15:37 2026\\x0A#CHROM\\x09POS\\x09ID\\x09REF\\x09ALT\\x09QUAL\\x09FILTER\\x09INFO\\x09FORMAT\\x09HG00098\\x09HG00100\\x09HG00106</span></span>
<span><span class="co">#&gt; 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           1.23.0.0.2.9000</span></span>
<span><span class="co">#&gt; 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     false</span></span>
<span></span>
<span><span class="co"># Extract the VCF header (stored with escaped newlines)</span></span>
<span><span class="va">vcf_header</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">[</span><span class="va">meta</span><span class="op">$</span><span class="va">key</span> <span class="op">==</span> <span class="st">"vcf_header"</span>, <span class="st">"value"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">vcf_header</span>, <span class="fl">1</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "##fileformat=VCFv4.0\\x0A##FILTER=&lt;ID=PASS,Description=\\x22All filters passed\\x22&gt;\\x0A##filedat=20101112\\x0A##datarelease=20100804\\x0A##samples=629\\x0A##contig=&lt;ID=1,length=249250621&gt;\\x0A##description="</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stream-remote-vcf-using-arrow-or-duckdb-extension">Stream Remote VCF using Arrow or DuckDB Extension<a class="anchor" aria-label="anchor" href="#stream-remote-vcf-using-arrow-or-duckdb-extension"></a>
</h3>
<p>Stream remote VCF region directly from S3 using either <code>nanoarrow</code> based <code>vcf_stream</code> or <code>duckb</code> extension</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s3_vcf_uri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">s3_base</span>, <span class="va">s3_path</span>, <span class="va">s3_vcf_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrow stream</span></span>
<span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_arrow.html">vcf_open_arrow</a></span><span class="op">(</span></span>
<span>    <span class="va">s3_vcf_uri</span>,</span>
<span>    region <span class="op">=</span> <span class="st">"chr22:16050000-16050500"</span>,</span>
<span>    batch_size <span class="op">=</span> <span class="fl">1000L</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/convert_array_stream.html" class="external-link">convert_array_stream</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span>, <span class="st">"ALT"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM      POS REF                  ALT</span></span>
<span><span class="co">#&gt; 1 chr22 16050036   A C        , &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 2 chr22 16050151   T G        , &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 3 chr22 16050213   C T        , &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 4 chr22 16050219   C A        , &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 5 chr22 16050224   A C        , &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 6 chr22 16050229   C A        , &lt;NON_REF&gt;</span></span>
<span></span>
<span></span>
<span><span class="co"># Query remote VCF with bcf_reader extension</span></span>
<span></span>
<span><span class="fu"><a href="reference/vcf_query_duckdb.html">vcf_query_duckdb</a></span><span class="op">(</span></span>
<span>    <span class="va">s3_vcf_uri</span>,</span>
<span>    <span class="va">ext_path</span>,</span>
<span>    region <span class="op">=</span> <span class="st">"chr22:16050000-16050500"</span>,</span>
<span>    query <span class="op">=</span> <span class="st">"SELECT CHROM, POS, REF, ALT FROM vcf LIMIT 5"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM      POS REF          ALT</span></span>
<span><span class="co">#&gt; 1 chr22 16050036   A C, &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 2 chr22 16050151   T G, &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 3 chr22 16050213   C T, &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 4 chr22 16050219   C A, &lt;NON_REF&gt;</span></span>
<span><span class="co">#&gt; 5 chr22 16050224   A C, &lt;NON_REF&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-index-file-path">Custom Index File Path<a class="anchor" aria-label="anchor" href="#custom-index-file-path"></a>
</h3>
<p>For region queries, an index file is required. By default, RBCFTools looks for <code>.tbi</code> (tabix) or <code>.csi</code> indexes using standard naming conventions. For non-standard index locations such as presigned URLs or custom paths, use the <code>index</code> parameter. Index files are only required for region queries; when reading an entire file without a region filter, no index is needed. VCF files try <code>.tbi</code> first then fall back to <code>.csi</code>, while BCF files use <code>.csi</code> only.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Explicit index file path</span></span>
<span><span class="va">bcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.bcf"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">csi_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"1000G_3samples.bcf.csi"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_arrow.html">vcf_open_arrow</a></span><span class="op">(</span><span class="va">bcf_file</span>, index <span class="op">=</span> <span class="va">csi_index</span><span class="op">)</span></span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="va">stream</span><span class="op">$</span><span class="fu">get_next</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/convert_array.html" class="external-link">convert_array</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF</span></span>
<span><span class="co">#&gt; 1     1 10583   G</span></span>
<span><span class="co">#&gt; 2     1 11508   A</span></span>
<span><span class="co">#&gt; 3     1 11565   G</span></span>
<span><span class="co"># Alternative: htslib ##idx## syntax in filename</span></span>
<span><span class="va">filename_with_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">bcf_file</span>, <span class="st">"##idx##"</span>, <span class="va">csi_index</span><span class="op">)</span></span>
<span><span class="va">stream2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vcf_open_arrow.html">vcf_open_arrow</a></span><span class="op">(</span><span class="va">filename_with_idx</span><span class="op">)</span></span>
<span><span class="va">batch2</span> <span class="op">&lt;-</span> <span class="va">stream2</span><span class="op">$</span><span class="fu">get_next</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/convert_array.html" class="external-link">convert_array</a></span><span class="op">(</span><span class="va">batch2</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHROM"</span>, <span class="st">"POS"</span>, <span class="st">"REF"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CHROM   POS REF</span></span>
<span><span class="co">#&gt; 1     1 10583   G</span></span>
<span><span class="co">#&gt; 2     1 11508   A</span></span>
<span><span class="co">#&gt; 3     1 11565   G</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-application-ducklake-etl">Example Application: DuckLake ETL<a class="anchor" aria-label="anchor" href="#example-application-ducklake-etl"></a>
</h2>
<p><a href="https://ducklake.select/" class="external-link"><code>DuckLake</code></a> is an integrated data lake and catalog format. It has two components, a parquet files storage and a metadata dababase layer.</p>
<div class="section level3">
<h3 id="ducklake-etl-to-minio-storage-backend">DuckLake ETL to MinIO Storage backend<a class="anchor" aria-label="anchor" href="#ducklake-etl-to-minio-storage-backend"></a>
</h3>
<p>To mimick a S3 backend for <a href="https://ducklake.select/" class="external-link"><code>DuckLake</code></a> storage we use <a href="github.com/minio/minio">minio</a>, we convert VCF files to parquet and insert then into DuckLake and query the lake. The lake as a local duckdb metadata database in this example</p>
<div class="section level4">
<h4 id="setup-up-minio-storage-backend">Setup up <code>minio</code> storage backend<a class="anchor" aria-label="anchor" href="#setup-up-minio-storage-backend"></a>
</h4>
<p>We start by seting up and configuring a <code>minio</code> server</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># DuckLake with S3-compatible storage using local MinIO</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"processx"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"processx required"</span><span class="op">)</span></span>
<span><span class="va">bin_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"ducklake_bins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">bin_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use installed MinIO and MC binaries</span></span>
<span><span class="va">minio_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">'minio'</span><span class="op">)</span></span>
<span><span class="va">mc_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">'mc'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start MinIO (ephemeral) and configure mc</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"ducklake_minio"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">port</span> <span class="op">&lt;-</span> <span class="fl">9000</span></span>
<span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"127.0.0.1:%d"</span>, <span class="va">port</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start MinIO server in background</span></span>
<span><span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>  <span class="st">"%s server %s --address %s &gt; /dev/null 2&gt;&amp;1 &amp; echo $!"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/shQuote.html" class="external-link">shQuote</a></span><span class="op">(</span><span class="va">minio_bin</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/shQuote.html" class="external-link">shQuote</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span>,</span>
<span>  <span class="va">endpoint</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pid_output</span> <span class="op">&lt;-</span> <span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span><span class="st">"sh"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-c"</span>, <span class="va">cmd</span><span class="op">)</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">stdout</span></span>
<span><span class="va">pid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">pid_output</span><span class="op">)</span></span>
<span><span class="va">pid</span></span>
<span><span class="co">#&gt; [1] 183484</span></span>
<span><span class="co"># Give MinIO time to start</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure mc alias</span></span>
<span><span class="co"># remove previous alias</span></span>
<span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span></span>
<span>  <span class="va">mc_bin</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alias"</span>, <span class="st">"remove"</span>, <span class="st">"ducklake_local"</span><span class="op">)</span>,</span>
<span>  error_on_status <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  echo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stdout</span></span>
<span><span class="co">#&gt; [1] "Removed `ducklake_local` successfully.\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stderr</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $timeout</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="va">mc_cmd_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alias"</span>, <span class="st">"set"</span>, <span class="st">"ducklake_local"</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"http://"</span>, <span class="va">endpoint</span><span class="op">)</span>, <span class="st">"minioadmin"</span>, <span class="st">"minioadmin"</span><span class="op">)</span></span>
<span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span><span class="va">mc_bin</span>, <span class="va">mc_cmd_args</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stdout</span></span>
<span><span class="co">#&gt; [1] "Added `ducklake_local` successfully.\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stderr</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $timeout</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># Create bucket with unique name</span></span>
<span><span class="va">bucket</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"readme-demo-%d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bucket_cmd_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mb"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ducklake_local/"</span>, <span class="va">bucket</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span><span class="va">mc_bin</span>, <span class="va">bucket_cmd_args</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stdout</span></span>
<span><span class="co">#&gt; [1] "Bucket created successfully `ducklake_local/readme-demo-1768436151`.\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stderr</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $timeout</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># Store variables for later use</span></span>
<span><span class="va">minio_endpoint</span> <span class="op">&lt;-</span> <span class="va">endpoint</span></span>
<span><span class="va">bucket_name</span> <span class="op">&lt;-</span> <span class="va">bucket</span></span>
<span><span class="va">data_root_s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s3://"</span>, <span class="va">bucket_name</span><span class="op">)</span></span>
<span><span class="va">data_path_s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_root_s3</span>, <span class="st">"/data/"</span><span class="op">)</span></span>
<span><span class="va">mc_path</span> <span class="op">&lt;-</span> <span class="va">mc_bin</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="attach-a-ducklake">Attach a DuckLake<a class="anchor" aria-label="anchor" href="#attach-a-ducklake"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span>config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  allow_unsigned_extensions <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>  enable_external_access <span class="op">=</span> <span class="st">"true"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbIsValid.html" class="external-link">dbIsValid</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"INSTALL httpfs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"LOAD httpfs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"INSTALL ducklake FROM core_nightly"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"LOAD ducklake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># Provide S3 credentials/endpoints for MinIO</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span></span>
<span>  AWS_ACCESS_KEY_ID <span class="op">=</span> <span class="st">"minioadmin"</span>,</span>
<span>  AWS_SECRET_ACCESS_KEY <span class="op">=</span> <span class="st">"minioadmin"</span>,</span>
<span>  AWS_DEFAULT_REGION <span class="op">=</span> <span class="st">"us-east-1"</span>,</span>
<span>  AWS_S3_ENDPOINT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"http://"</span>, <span class="va">minio_endpoint</span><span class="op">)</span>,</span>
<span>  AWS_S3_USE_HTTPS <span class="op">=</span> <span class="st">"FALSE"</span>,</span>
<span>  AWS_S3_FORCE_PATH_STYLE <span class="op">=</span> <span class="st">"TRUE"</span>,</span>
<span>  AWS_EC2_METADATA_DISABLED <span class="op">=</span> <span class="st">"TRUE"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/ducklake_create_s3_secret.html">ducklake_create_s3_secret</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"ducklake_minio"</span>,</span>
<span>  key_id <span class="op">=</span> <span class="st">"minioadmin"</span>,</span>
<span>  secret <span class="op">=</span> <span class="st">"minioadmin"</span>,</span>
<span>  endpoint <span class="op">=</span> <span class="va">minio_endpoint</span>,</span>
<span>  region <span class="op">=</span> <span class="st">"us-east-1"</span>,</span>
<span>  use_ssl <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"ducklake_meta_%s.ducklake"</span>, <span class="va">bucket_name</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/ducklake_attach.html">ducklake_attach</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="va">metadata_path</span>,</span>
<span>  data_path <span class="op">=</span> <span class="va">data_path_s3</span>,</span>
<span>  alias <span class="op">=</span> <span class="st">"lake"</span>,</span>
<span>  extra_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>OVERRIDE_DATA_PATH <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Work inside the attached lake database</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"USE lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="write-a-vcf-into-minio-and-register-to-the-lake">Write a VCF into minio and register to the Lake<a class="anchor" aria-label="anchor" href="#write-a-vcf-into-minio-and-register-to-the-lake"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure we are operating inside the DuckLake catalog</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"USE lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># Load variants via fast VCF to Parquet conversion</span></span>
<span><span class="va">vcf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_deep_variant.vcf.gz"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">ext_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bcf_reader_build.html">bcf_reader_build</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bcf_reader extension already exists at: /tmp/RtmpanmlwP/build/bcf_reader.duckdb_extension</span></span>
<span><span class="co">#&gt; Use force=TRUE to rebuild.</span></span>
<span><span class="fu"><a href="reference/ducklake_load_vcf.html">ducklake_load_vcf</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"variants"</span>,</span>
<span>  vcf_path <span class="op">=</span> <span class="va">vcf_file</span>,</span>
<span>  extension_path <span class="op">=</span> <span class="va">ext_path</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  tidy_format <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote: /tmp/RtmpanmlwP/variants_20260115_011551.parquet</span></span>
<span><span class="co">#&gt; Note: method with signature 'DBIConnection#Id' chosen for function 'dbExistsTable',</span></span>
<span><span class="co">#&gt;  target signature 'duckdb_connection#Id'.</span></span>
<span><span class="co">#&gt;  "duckdb_connection#ANY" would also be valid</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="add-another-vcf-file-with-different-schema">Add another VCF file with different schema<a class="anchor" aria-label="anchor" href="#add-another-vcf-file-with-different-schema"></a>
</h3>
<p>DuckLake supports schema evolution via <code>ALTER TABLE</code>. Use <code>allow_evolution = TRUE</code> to automatically add new columns from incoming files.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"USE lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">variants_count</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) as n FROM variants"</span><span class="op">)</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">variants_count</span></span>
<span><span class="co">#&gt; [1] 368319</span></span>
<span></span>
<span><span class="va">vcf_file2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_vep.vcf"</span>, package <span class="op">=</span> <span class="st">"RBCFTools"</span><span class="op">)</span></span>
<span><span class="va">local_parquet2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/vcf_to_parquet_duckdb.html">vcf_to_parquet_duckdb</a></span><span class="op">(</span><span class="va">vcf_file2</span>, <span class="va">local_parquet2</span>, extension_path <span class="op">=</span> <span class="va">ext_path</span>, tidy_format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Wrote: /tmp/RtmpanmlwP/file2cb1d540eaf6e.parquet</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT COUNT(*) as n FROM read_parquet('%s')"</span>, <span class="va">local_parquet2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     n</span></span>
<span><span class="co">#&gt; 1 802</span></span>
<span></span>
<span><span class="va">s3_parquet2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_path_s3</span>, <span class="st">"variants/variants_vep.parquet"</span><span class="op">)</span></span>
<span><span class="va">mc_cmd_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cp"</span>, <span class="va">local_parquet2</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ducklake_local/"</span>, <span class="va">bucket_name</span>, <span class="st">"/data/variants/variants_vep.parquet"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">processx</span><span class="fu">::</span><span class="fu"><a href="http://processx.r-lib.org/reference/run.html" class="external-link">run</a></span><span class="op">(</span><span class="va">mc_bin</span>, <span class="va">mc_cmd_args</span>, echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stdout</span></span>
<span><span class="co">#&gt; [1] "`/tmp/RtmpanmlwP/file2cb1d540eaf6e.parquet` -&gt; `ducklake_local/readme-demo-1768436151/data/variants/variants_vep.parquet`\n┌────────────┬─────────────┬──────────┬────────────┐\n│ Total      │ Transferred │ Duration │ Speed      │\n│ 122.34 KiB │ 122.34 KiB  │ 00m00s   │ 9.92 MiB/s │\n└────────────┴─────────────┴──────────┴────────────┘\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stderr</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $timeout</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"SELECT COUNT(*) as n FROM read_parquet('%s')"</span>, <span class="va">s3_parquet2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     n</span></span>
<span><span class="co">#&gt; 1 802</span></span>
<span></span>
<span><span class="fu"><a href="reference/ducklake_register_parquet.html">ducklake_register_parquet</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"lake.variants"</span>,</span>
<span>  parquet_files <span class="op">=</span> <span class="va">s3_parquet2</span>,</span>
<span>  create_table <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  allow_evolution <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">variants_count_after</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) as n FROM variants"</span><span class="op">)</span><span class="op">$</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">variants_count_after</span></span>
<span><span class="co">#&gt; [1] 369121</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="list-lake-content">List lake content<a class="anchor" aria-label="anchor" href="#list-lake-content"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"USE lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"</span></span>
<span><span class="st">  SELECT </span></span>
<span><span class="st">    COUNT(*) as total_variants,</span></span>
<span><span class="st">    COUNT(DISTINCT CHROM) as n_chromosomes,</span></span>
<span><span class="st">    MIN(POS) as min_position,</span></span>
<span><span class="st">    MAX(POS) as max_position</span></span>
<span><span class="st">  FROM variants</span></span>
<span><span class="st">"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   total_variants n_chromosomes min_position max_position</span></span>
<span><span class="co">#&gt; 1         369121            25          152    249211717</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"DESCRIBE variants"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;        column_name column_type null  key default extra</span></span>
<span><span class="co">#&gt; 1            CHROM     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2              POS      BIGINT  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3               ID     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4              REF     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5              ALT   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6             QUAL      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7           FILTER   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8         INFO_END     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9        SAMPLE_ID     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10       FORMAT_GT     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11       FORMAT_GQ     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12       FORMAT_DP     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13   FORMAT_MIN_DP     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14       FORMAT_AD   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15      FORMAT_VAF     FLOAT[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16       FORMAT_PL   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 17   FORMAT_MED_DP     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 18      VEP_Allele   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 19 VEP_Consequence   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 20      VEP_IMPACT   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ducklake_list_files.html">ducklake_list_files</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span>, <span class="st">"variants"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                                                              data_file</span></span>
<span><span class="co">#&gt; 1 s3://readme-demo-1768436151/data/main/variants/ducklake-019bbf02-380b-707c-89d5-4a38b243b0c5.parquet</span></span>
<span><span class="co">#&gt; 2                                       s3://readme-demo-1768436151/data/variants/variants_vep.parquet</span></span>
<span><span class="co">#&gt;   data_file_size_bytes data_file_footer_size data_file_encryption_key</span></span>
<span><span class="co">#&gt; 1              5751964                  6113                     NULL</span></span>
<span><span class="co">#&gt; 2               125274                 16367                     NULL</span></span>
<span><span class="co">#&gt;   delete_file delete_file_size_bytes delete_file_footer_size</span></span>
<span><span class="co">#&gt; 1        &lt;NA&gt;                     NA                      NA</span></span>
<span><span class="co">#&gt; 2        &lt;NA&gt;                     NA                      NA</span></span>
<span><span class="co">#&gt;   delete_file_encryption_key</span></span>
<span><span class="co">#&gt; 1                       NULL</span></span>
<span><span class="co">#&gt; 2                       NULL</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="snapshots-and-time-travel">Snapshots and time travel<a class="anchor" aria-label="anchor" href="#snapshots-and-time-travel"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ducklake_snapshots.html">ducklake_snapshots</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   snapshot_id       snapshot_time schema_version</span></span>
<span><span class="co">#&gt; 1           0 2026-01-15 00:15:51              0</span></span>
<span><span class="co">#&gt; 2           1 2026-01-15 00:15:52              1</span></span>
<span><span class="co">#&gt; 3           2 2026-01-15 00:15:52              2</span></span>
<span><span class="co">#&gt; 4           3 2026-01-15 00:15:52              3</span></span>
<span><span class="co">#&gt; 5           4 2026-01-15 00:15:52              4</span></span>
<span><span class="co">#&gt; 6           5 2026-01-15 00:15:52              5</span></span>
<span><span class="co">#&gt;                                                  changes author commit_message</span></span>
<span><span class="co">#&gt; 1                                  schemas_created, main   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 tables_created, tables_inserted_into, main.variants, 1   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                                      tables_altered, 1   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4                                      tables_altered, 1   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5                                      tables_altered, 1   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6                                      tables_altered, 1   &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">#&gt;   commit_extra_info</span></span>
<span><span class="co">#&gt; 1              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6              &lt;NA&gt;</span></span>
<span><span class="fu"><a href="reference/ducklake_snapshots.html">ducklake_snapshots</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    snapshot_id       snapshot_time schema_version                 changes</span></span>
<span><span class="co">#&gt; 84          83 2026-01-15 00:15:53             83       tables_altered, 1</span></span>
<span><span class="co">#&gt; 85          84 2026-01-15 00:15:53             84       tables_altered, 1</span></span>
<span><span class="co">#&gt; 86          85 2026-01-15 00:15:53             85       tables_altered, 1</span></span>
<span><span class="co">#&gt; 87          86 2026-01-15 00:15:53             86       tables_altered, 1</span></span>
<span><span class="co">#&gt; 88          87 2026-01-15 00:15:53             87       tables_altered, 1</span></span>
<span><span class="co">#&gt; 89          88 2026-01-15 00:15:53             87 tables_inserted_into, 1</span></span>
<span><span class="co">#&gt;    author commit_message commit_extra_info</span></span>
<span><span class="co">#&gt; 84   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 85   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 86   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 87   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 88   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 89   &lt;NA&gt;           &lt;NA&gt;              &lt;NA&gt;</span></span>
<span></span>
<span><span class="fu"><a href="reference/ducklake_current_snapshot.html">ducklake_current_snapshot</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 88</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ducklake_options.html">ducklake_options</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   option_name                                                      description</span></span>
<span><span class="co">#&gt; 1  created_by                                  Tool used to write the DuckLake</span></span>
<span><span class="co">#&gt; 2   data_path                                               Path to data files</span></span>
<span><span class="co">#&gt; 3   encrypted Whether or not to encrypt Parquet files written to the data path</span></span>
<span><span class="co">#&gt; 4     version                                          DuckLake format version</span></span>
<span><span class="co">#&gt;                               value  scope scope_entry</span></span>
<span><span class="co">#&gt; 1                 DuckDB d1dc88f950 GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 s3://readme-demo-1768436151/data/ GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                             false GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4                               0.3 GLOBAL        &lt;NA&gt;</span></span>
<span><span class="fu"><a href="reference/ducklake_set_option.html">ducklake_set_option</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span>, <span class="st">"parquet_compression"</span>, <span class="st">"zstd"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/ducklake_options.html">ducklake_options</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"lake"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           option_name</span></span>
<span><span class="co">#&gt; 1          created_by</span></span>
<span><span class="co">#&gt; 2           data_path</span></span>
<span><span class="co">#&gt; 3           encrypted</span></span>
<span><span class="co">#&gt; 4 parquet_compression</span></span>
<span><span class="co">#&gt; 5             version</span></span>
<span><span class="co">#&gt;                                                                                        description</span></span>
<span><span class="co">#&gt; 1                                                                  Tool used to write the DuckLake</span></span>
<span><span class="co">#&gt; 2                                                                               Path to data files</span></span>
<span><span class="co">#&gt; 3                                 Whether or not to encrypt Parquet files written to the data path</span></span>
<span><span class="co">#&gt; 4 Compression algorithm for Parquet files (uncompressed, snappy, gzip, zstd, brotli, lz4, lz4_raw)</span></span>
<span><span class="co">#&gt; 5                                                                          DuckLake format version</span></span>
<span><span class="co">#&gt;                               value  scope scope_entry</span></span>
<span><span class="co">#&gt; 1                 DuckDB d1dc88f950 GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 s3://readme-demo-1768436151/data/ GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                             false GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4                              zstd GLOBAL        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5                               0.3 GLOBAL        &lt;NA&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/pskill.html" class="external-link">pskill</a></span><span class="op">(</span><span class="va">pid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="supported-metadata-databases">Supported Metadata Databases<a class="anchor" aria-label="anchor" href="#supported-metadata-databases"></a>
</h3>
<p>DuckLake supports multiple catalog backends</p>
<ul>
<li>
<code>DuckDB</code> : <code>ducklake:path/to/catalog.ducklake</code>
</li>
<li>
<code>SQLite</code>: <code>ducklake:sqlite://path/to/catalog.db</code><br>
</li>
<li>
<code>PostgreSQL</code> : <code>ducklake:postgresql://user:pass@host:5432/db</code>
</li>
<li>
<code>MySQL</code>: <code>ducklake:mysql://user:pass@host:3306/db</code>
</li>
</ul>
<div class="section level4">
<h4 id="connection-methods">Connection Methods<a class="anchor" aria-label="anchor" href="#connection-methods"></a>
</h4>
<p>The package provides helpers for different metadata databases</p>
</div>
<div class="section level4">
<h4 id="direct-connection">Direct Connection<a class="anchor" aria-label="anchor" href="#direct-connection"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># DuckDB backend</span></span>
<span><span class="fu"><a href="reference/ducklake_connect_catalog.html">ducklake_connect_catalog</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"duckdb"</span>,</span>
<span>  connection_string <span class="op">=</span> <span class="st">"catalog.ducklake"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://bucket/data/"</span>,</span>
<span>  alias <span class="op">=</span> <span class="st">"lake"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># PostgreSQL backend</span></span>
<span><span class="fu"><a href="reference/ducklake_connect_catalog.html">ducklake_connect_catalog</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>  connection_string <span class="op">=</span> <span class="st">"user:pass@host:5432/db"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://bucket/data/"</span>,</span>
<span>  alias <span class="op">=</span> <span class="st">"lake"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="secret-based-connection">Secret-based Connection:**<a class="anchor" aria-label="anchor" href="#secret-based-connection"></a>
</h5>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create catalog secret</span></span>
<span><span class="fu"><a href="reference/ducklake_create_catalog_secret.html">ducklake_create_catalog_secret</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"pg_catalog"</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"postgresql"</span>,</span>
<span>  connection_string <span class="op">=</span> <span class="st">"user:pass@host:5432/db"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"s3://bucket/data/"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect using secret</span></span>
<span><span class="fu"><a href="reference/ducklake_connect_catalog.html">ducklake_connect_catalog</a></span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  secret_name <span class="op">=</span> <span class="st">"pg_catalog"</span>,</span>
<span>  alias <span class="op">=</span> <span class="st">"lake"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="command-line-utilities">Command-Line utilities<a class="anchor" aria-label="anchor" href="#command-line-utilities"></a>
</h2>
<p>CLI tools are provided for VCF to Parquet conversion and querying, including threaded chunking based on contigs using either the <a href="./inst/scripts/vcf2parquet_duckdb.R"><code>bcf_reader</code></a> extension or via <a href="./inst/scripts/vcf2parquet.R">Arrow IPC</a></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># Get paths using system.file</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="va">SCRIPT</span><span class="op">=</span><span class="va">$(</span><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"cat(system.file('scripts', 'vcf2parquet_duckdb.R', package='RBCFTools'))"</span><span class="va">)</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="va">BCF</span><span class="op">=</span><span class="va">$(</span><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"cat(system.file('extdata', 'test_deep_variant.vcf.gz', package='RBCFTools'))"</span><span class="va">)</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="va">OUT_PQ</span><span class="op">=</span><span class="va">$(</span><span class="fu">mktemp</span> <span class="at">--suffix</span><span class="op">=</span>.parquet<span class="va">)</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="va">Log</span><span class="op">=</span><span class="va">$(</span><span class="fu">mktemp</span> <span class="at">--suffix</span><span class="op">=</span>.log<span class="va">)</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="co"># Convert BCF to Parquet</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="bu">time</span> <span class="va">$SCRIPT</span> convert <span class="at">--quiet</span> <span class="at">-i</span> <span class="va">$BCF</span> <span class="at">-o</span> <span class="va">$OUT_PQ</span> <span class="at">-t</span> 4  <span class="op">&gt;</span> <span class="va">$Log</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="fu">cat</span> <span class="va">$Log</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="co"># Query with DuckDB SQL</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="va">$SCRIPT</span> query <span class="at">-i</span> <span class="va">$OUT_PQ</span> <span class="at">-q</span> <span class="st">"SELECT * FROM parquet_scan('</span><span class="va">$OUT_PQ</span><span class="st">') LIMIT 5"</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="co"># Describe table structure</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="va">$SCRIPT</span> query <span class="at">-i</span> <span class="va">$OUT_PQ</span> <span class="at">-q</span> <span class="st">"DESCRIBE SELECT * FROM parquet_scan('</span><span class="va">$OUT_PQ</span><span class="st">')"</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co"># Show schema</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a><span class="va">$SCRIPT</span> schema  <span class="at">--quiet</span> <span class="at">-i</span> <span class="va">$BCF</span> </span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a><span class="co"># File info</span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a><span class="va">$SCRIPT</span> info <span class="at">-i</span> <span class="va">$OUT_PQ</span> </span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-f</span> <span class="va">$OUT_PQ</span></span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a><span class="co">#&gt; real 0m1.683s</span></span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a><span class="co">#&gt; user 0m3.711s</span></span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a><span class="co">#&gt; sys  0m2.100s</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a><span class="co">#&gt; Building bcf_reader extension...</span></span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a><span class="co">#&gt;   Build directory: /tmp/RtmpbbgV8E </span></span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a><span class="co">#&gt; Building bcf_reader extension...</span></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a><span class="co">#&gt;   Build directory: /tmp/RtmpbbgV8E</span></span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a><span class="co">#&gt;   Using htslib from: /usr/local/lib/R/site-library/RBCFTools/htslib/lib</span></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a><span class="co">#&gt;   Running: make with explicit htslib paths</span></span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a><span class="co">#&gt; make[1]: Entering directory '/tmp/RtmpbbgV8E'</span></span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a><span class="co">#&gt; rm -rf build</span></span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a><span class="co">#&gt; make[1]: Leaving directory '/tmp/RtmpbbgV8E'</span></span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a><span class="co">#&gt; make[1]: Entering directory '/tmp/RtmpbbgV8E'</span></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a><span class="co">#&gt; mkdir -p build</span></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a><span class="co">#&gt; gcc -O2 -Wall -Wextra -Wno-unused-parameter -fPIC -I/usr/local/lib/R/site-library/RBCFTools/htslib/include -I. -c bcf_reader.c -o build/bcf_reader.o</span></span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a><span class="co">#&gt; gcc -O2 -Wall -Wextra -Wno-unused-parameter -fPIC -I/usr/local/lib/R/site-library/RBCFTools/htslib/include -I. -c vep_parser.c -o build/vep_parser.o</span></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a><span class="co">#&gt; gcc -shared -fPIC -o build/libbcf_reader.so build/bcf_reader.o build/vep_parser.o -L/usr/local/lib/R/site-library/RBCFTools/htslib/lib -Wl,-rpath,/usr/local/lib/R/site-library/RBCFTools/htslib/lib -lhts</span></span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a><span class="co">#&gt; Creating DuckDB extension with metadata...</span></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a><span class="co">#&gt; Created: build/bcf_reader.duckdb_extension</span></span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a><span class="co">#&gt;   Platform: linux_amd64</span></span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a><span class="co">#&gt;   DuckDB Version: v1.2.0</span></span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a><span class="co">#&gt;   Extension Version: 1.0.0</span></span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a><span class="co">#&gt; make[1]: Leaving directory '/tmp/RtmpbbgV8E'</span></span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a><span class="co">#&gt; Extension built: /tmp/RtmpbbgV8E/build/bcf_reader.duckdb_extension</span></span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a><span class="co">#&gt; ✓ Extension ready: /tmp/RtmpbbgV8E/build/bcf_reader.duckdb_extension </span></span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a><span class="co">#&gt; Converting VCF to Parquet (DuckDB mode)...</span></span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a><span class="co">#&gt;   Input: /usr/local/lib/R/site-library/RBCFTools/extdata/test_deep_variant.vcf.gz </span></span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a><span class="co">#&gt;   Output: /tmp/tmp.2xxxp3kBwn.parquet </span></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="co">#&gt;   Compression: zstd </span></span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a><span class="co">#&gt;   Row group size: 100000 </span></span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a><span class="co">#&gt;   Threads: 4 </span></span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a><span class="co">#&gt; Processing 25 contigs (out of 86 in header) using 4 threads (DuckDB mode)</span></span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0004.parquet</span></span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0003.parquet</span></span>
<span id="cb33-61"><a href="#cb33-61" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0002.parquet</span></span>
<span id="cb33-62"><a href="#cb33-62" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0001.parquet</span></span>
<span id="cb33-63"><a href="#cb33-63" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0008.parquet</span></span>
<span id="cb33-64"><a href="#cb33-64" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0007.parquet</span></span>
<span id="cb33-65"><a href="#cb33-65" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0006.parquet</span></span>
<span id="cb33-66"><a href="#cb33-66" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0005.parquet</span></span>
<span id="cb33-67"><a href="#cb33-67" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0012.parquet</span></span>
<span id="cb33-68"><a href="#cb33-68" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0010.parquet</span></span>
<span id="cb33-69"><a href="#cb33-69" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0011.parquet</span></span>
<span id="cb33-70"><a href="#cb33-70" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0009.parquet</span></span>
<span id="cb33-71"><a href="#cb33-71" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0016.parquet</span></span>
<span id="cb33-72"><a href="#cb33-72" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0014.parquet</span></span>
<span id="cb33-73"><a href="#cb33-73" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0015.parquet</span></span>
<span id="cb33-74"><a href="#cb33-74" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0013.parquet</span></span>
<span id="cb33-75"><a href="#cb33-75" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0018.parquet</span></span>
<span id="cb33-76"><a href="#cb33-76" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0020.parquet</span></span>
<span id="cb33-77"><a href="#cb33-77" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0024.parquet</span></span>
<span id="cb33-78"><a href="#cb33-78" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0017.parquet</span></span>
<span id="cb33-79"><a href="#cb33-79" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0022.parquet</span></span>
<span id="cb33-80"><a href="#cb33-80" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0019.parquet</span></span>
<span id="cb33-81"><a href="#cb33-81" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0021.parquet</span></span>
<span id="cb33-82"><a href="#cb33-82" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0023.parquet</span></span>
<span id="cb33-83"><a href="#cb33-83" tabindex="-1"></a><span class="co">#&gt; Wrote: /tmp/RtmpbbgV8E/vcf_duckdb_parallel_2cdab70455753/contig_0025.parquet</span></span>
<span id="cb33-84"><a href="#cb33-84" tabindex="-1"></a><span class="co">#&gt; Merging temporary Parquet files... to /tmp/tmp.2xxxp3kBwn.parquet</span></span>
<span id="cb33-85"><a href="#cb33-85" tabindex="-1"></a><span class="co">#&gt; Merged 25 parquet files -&gt; tmp.2xxxp3kBwn.parquet (368319 rows)</span></span>
<span id="cb33-86"><a href="#cb33-86" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-87"><a href="#cb33-87" tabindex="-1"></a><span class="co">#&gt; ✓ Conversion complete!</span></span>
<span id="cb33-88"><a href="#cb33-88" tabindex="-1"></a><span class="co">#&gt;   Time: 1.01 seconds</span></span>
<span id="cb33-89"><a href="#cb33-89" tabindex="-1"></a><span class="co">#&gt;   Output size: 3.77 MB</span></span>
<span id="cb33-90"><a href="#cb33-90" tabindex="-1"></a><span class="co">#&gt; Running query on Parquet file...</span></span>
<span id="cb33-91"><a href="#cb33-91" tabindex="-1"></a><span class="co">#&gt;   CHROM    POS   ID REF ALT QUAL  FILTER INFO_END FORMAT_GT_test_deep_variant</span></span>
<span id="cb33-92"><a href="#cb33-92" tabindex="-1"></a><span class="co">#&gt; 1     1 536895 &lt;NA&gt;   T   C  0.1 RefCall       NA                         ./.</span></span>
<span id="cb33-93"><a href="#cb33-93" tabindex="-1"></a><span class="co">#&gt; 2     1 536924 &lt;NA&gt;   G   A  0.1 RefCall       NA                         ./.</span></span>
<span id="cb33-94"><a href="#cb33-94" tabindex="-1"></a><span class="co">#&gt; 3     1 536948 &lt;NA&gt;   A   G  0.0 RefCall       NA                         0/0</span></span>
<span id="cb33-95"><a href="#cb33-95" tabindex="-1"></a><span class="co">#&gt; 4     1 536986 &lt;NA&gt;   G   T  0.0 RefCall       NA                         0/0</span></span>
<span id="cb33-96"><a href="#cb33-96" tabindex="-1"></a><span class="co">#&gt; 5     1 544490 &lt;NA&gt;   A   G  0.8 RefCall       NA                         ./.</span></span>
<span id="cb33-97"><a href="#cb33-97" tabindex="-1"></a><span class="co">#&gt;   FORMAT_GQ_test_deep_variant FORMAT_DP_test_deep_variant</span></span>
<span id="cb33-98"><a href="#cb33-98" tabindex="-1"></a><span class="co">#&gt; 1                          18                         106</span></span>
<span id="cb33-99"><a href="#cb33-99" tabindex="-1"></a><span class="co">#&gt; 2                          18                         118</span></span>
<span id="cb33-100"><a href="#cb33-100" tabindex="-1"></a><span class="co">#&gt; 3                          31                         104</span></span>
<span id="cb33-101"><a href="#cb33-101" tabindex="-1"></a><span class="co">#&gt; 4                          23                         115</span></span>
<span id="cb33-102"><a href="#cb33-102" tabindex="-1"></a><span class="co">#&gt; 5                           8                          10</span></span>
<span id="cb33-103"><a href="#cb33-103" tabindex="-1"></a><span class="co">#&gt;   FORMAT_MIN_DP_test_deep_variant FORMAT_AD_test_deep_variant</span></span>
<span id="cb33-104"><a href="#cb33-104" tabindex="-1"></a><span class="co">#&gt; 1                              NA                      46, 52</span></span>
<span id="cb33-105"><a href="#cb33-105" tabindex="-1"></a><span class="co">#&gt; 2                              NA                      55, 60</span></span>
<span id="cb33-106"><a href="#cb33-106" tabindex="-1"></a><span class="co">#&gt; 3                              NA                      91, 13</span></span>
<span id="cb33-107"><a href="#cb33-107" tabindex="-1"></a><span class="co">#&gt; 4                              NA                      55, 60</span></span>
<span id="cb33-108"><a href="#cb33-108" tabindex="-1"></a><span class="co">#&gt; 5                              NA                        6, 4</span></span>
<span id="cb33-109"><a href="#cb33-109" tabindex="-1"></a><span class="co">#&gt;   FORMAT_VAF_test_deep_variant FORMAT_PL_test_deep_variant</span></span>
<span id="cb33-110"><a href="#cb33-110" tabindex="-1"></a><span class="co">#&gt; 1                     0.490566                   0, 19, 25</span></span>
<span id="cb33-111"><a href="#cb33-111" tabindex="-1"></a><span class="co">#&gt; 2                     0.508475                   0, 21, 20</span></span>
<span id="cb33-112"><a href="#cb33-112" tabindex="-1"></a><span class="co">#&gt; 3                        0.125                   0, 31, 38</span></span>
<span id="cb33-113"><a href="#cb33-113" tabindex="-1"></a><span class="co">#&gt; 4                     0.521739                   0, 23, 29</span></span>
<span id="cb33-114"><a href="#cb33-114" tabindex="-1"></a><span class="co">#&gt; 5                          0.4                    0, 7, 15</span></span>
<span id="cb33-115"><a href="#cb33-115" tabindex="-1"></a><span class="co">#&gt;   FORMAT_MED_DP_test_deep_variant</span></span>
<span id="cb33-116"><a href="#cb33-116" tabindex="-1"></a><span class="co">#&gt; 1                              NA</span></span>
<span id="cb33-117"><a href="#cb33-117" tabindex="-1"></a><span class="co">#&gt; 2                              NA</span></span>
<span id="cb33-118"><a href="#cb33-118" tabindex="-1"></a><span class="co">#&gt; 3                              NA</span></span>
<span id="cb33-119"><a href="#cb33-119" tabindex="-1"></a><span class="co">#&gt; 4                              NA</span></span>
<span id="cb33-120"><a href="#cb33-120" tabindex="-1"></a><span class="co">#&gt; 5                              NA</span></span>
<span id="cb33-121"><a href="#cb33-121" tabindex="-1"></a><span class="co">#&gt; Running query on Parquet file...</span></span>
<span id="cb33-122"><a href="#cb33-122" tabindex="-1"></a><span class="co">#&gt;                        column_name column_type null  key default extra</span></span>
<span id="cb33-123"><a href="#cb33-123" tabindex="-1"></a><span class="co">#&gt; 1                            CHROM     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-124"><a href="#cb33-124" tabindex="-1"></a><span class="co">#&gt; 2                              POS      BIGINT  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-125"><a href="#cb33-125" tabindex="-1"></a><span class="co">#&gt; 3                               ID     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-126"><a href="#cb33-126" tabindex="-1"></a><span class="co">#&gt; 4                              REF     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-127"><a href="#cb33-127" tabindex="-1"></a><span class="co">#&gt; 5                              ALT   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-128"><a href="#cb33-128" tabindex="-1"></a><span class="co">#&gt; 6                             QUAL      DOUBLE  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-129"><a href="#cb33-129" tabindex="-1"></a><span class="co">#&gt; 7                           FILTER   VARCHAR[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-130"><a href="#cb33-130" tabindex="-1"></a><span class="co">#&gt; 8                         INFO_END     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-131"><a href="#cb33-131" tabindex="-1"></a><span class="co">#&gt; 9      FORMAT_GT_test_deep_variant     VARCHAR  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-132"><a href="#cb33-132" tabindex="-1"></a><span class="co">#&gt; 10     FORMAT_GQ_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-133"><a href="#cb33-133" tabindex="-1"></a><span class="co">#&gt; 11     FORMAT_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-134"><a href="#cb33-134" tabindex="-1"></a><span class="co">#&gt; 12 FORMAT_MIN_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-135"><a href="#cb33-135" tabindex="-1"></a><span class="co">#&gt; 13     FORMAT_AD_test_deep_variant   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-136"><a href="#cb33-136" tabindex="-1"></a><span class="co">#&gt; 14    FORMAT_VAF_test_deep_variant     FLOAT[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-137"><a href="#cb33-137" tabindex="-1"></a><span class="co">#&gt; 15     FORMAT_PL_test_deep_variant   INTEGER[]  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-138"><a href="#cb33-138" tabindex="-1"></a><span class="co">#&gt; 16 FORMAT_MED_DP_test_deep_variant     INTEGER  YES &lt;NA&gt;    &lt;NA&gt;  &lt;NA&gt;</span></span>
<span id="cb33-139"><a href="#cb33-139" tabindex="-1"></a><span class="co">#&gt; Building bcf_reader extension...</span></span>
<span id="cb33-140"><a href="#cb33-140" tabindex="-1"></a><span class="co">#&gt;   Build directory: /tmp/RtmpzPKJKq </span></span>
<span id="cb33-141"><a href="#cb33-141" tabindex="-1"></a><span class="co">#&gt; Building bcf_reader extension...</span></span>
<span id="cb33-142"><a href="#cb33-142" tabindex="-1"></a><span class="co">#&gt;   Build directory: /tmp/RtmpzPKJKq</span></span>
<span id="cb33-143"><a href="#cb33-143" tabindex="-1"></a><span class="co">#&gt;   Using htslib from: /usr/local/lib/R/site-library/RBCFTools/htslib/lib</span></span>
<span id="cb33-144"><a href="#cb33-144" tabindex="-1"></a><span class="co">#&gt;   Running: make with explicit htslib paths</span></span>
<span id="cb33-145"><a href="#cb33-145" tabindex="-1"></a><span class="co">#&gt; make[1]: Entering directory '/tmp/RtmpzPKJKq'</span></span>
<span id="cb33-146"><a href="#cb33-146" tabindex="-1"></a><span class="co">#&gt; rm -rf build</span></span>
<span id="cb33-147"><a href="#cb33-147" tabindex="-1"></a><span class="co">#&gt; make[1]: Leaving directory '/tmp/RtmpzPKJKq'</span></span>
<span id="cb33-148"><a href="#cb33-148" tabindex="-1"></a><span class="co">#&gt; make[1]: Entering directory '/tmp/RtmpzPKJKq'</span></span>
<span id="cb33-149"><a href="#cb33-149" tabindex="-1"></a><span class="co">#&gt; mkdir -p build</span></span>
<span id="cb33-150"><a href="#cb33-150" tabindex="-1"></a><span class="co">#&gt; gcc -O2 -Wall -Wextra -Wno-unused-parameter -fPIC -I/usr/local/lib/R/site-library/RBCFTools/htslib/include -I. -c bcf_reader.c -o build/bcf_reader.o</span></span>
<span id="cb33-151"><a href="#cb33-151" tabindex="-1"></a><span class="co">#&gt; gcc -O2 -Wall -Wextra -Wno-unused-parameter -fPIC -I/usr/local/lib/R/site-library/RBCFTools/htslib/include -I. -c vep_parser.c -o build/vep_parser.o</span></span>
<span id="cb33-152"><a href="#cb33-152" tabindex="-1"></a><span class="co">#&gt; gcc -shared -fPIC -o build/libbcf_reader.so build/bcf_reader.o build/vep_parser.o -L/usr/local/lib/R/site-library/RBCFTools/htslib/lib -Wl,-rpath,/usr/local/lib/R/site-library/RBCFTools/htslib/lib -lhts</span></span>
<span id="cb33-153"><a href="#cb33-153" tabindex="-1"></a><span class="co">#&gt; Creating DuckDB extension with metadata...</span></span>
<span id="cb33-154"><a href="#cb33-154" tabindex="-1"></a><span class="co">#&gt; Created: build/bcf_reader.duckdb_extension</span></span>
<span id="cb33-155"><a href="#cb33-155" tabindex="-1"></a><span class="co">#&gt;   Platform: linux_amd64</span></span>
<span id="cb33-156"><a href="#cb33-156" tabindex="-1"></a><span class="co">#&gt;   DuckDB Version: v1.2.0</span></span>
<span id="cb33-157"><a href="#cb33-157" tabindex="-1"></a><span class="co">#&gt;   Extension Version: 1.0.0</span></span>
<span id="cb33-158"><a href="#cb33-158" tabindex="-1"></a><span class="co">#&gt; make[1]: Leaving directory '/tmp/RtmpzPKJKq'</span></span>
<span id="cb33-159"><a href="#cb33-159" tabindex="-1"></a><span class="co">#&gt; Extension built: /tmp/RtmpzPKJKq/build/bcf_reader.duckdb_extension</span></span>
<span id="cb33-160"><a href="#cb33-160" tabindex="-1"></a><span class="co">#&gt; ✓ Extension ready: /tmp/RtmpzPKJKq/build/bcf_reader.duckdb_extension </span></span>
<span id="cb33-161"><a href="#cb33-161" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-162"><a href="#cb33-162" tabindex="-1"></a><span class="co">#&gt; VCF DuckDB Schema for: /usr/local/lib/R/site-library/RBCFTools/extdata/test_deep_variant.vcf.gz </span></span>
<span id="cb33-163"><a href="#cb33-163" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-164"><a href="#cb33-164" tabindex="-1"></a><span class="co">#&gt;                      column_name column_type</span></span>
<span id="cb33-165"><a href="#cb33-165" tabindex="-1"></a><span class="co">#&gt;                            CHROM   character</span></span>
<span id="cb33-166"><a href="#cb33-166" tabindex="-1"></a><span class="co">#&gt;                              POS     numeric</span></span>
<span id="cb33-167"><a href="#cb33-167" tabindex="-1"></a><span class="co">#&gt;                               ID   character</span></span>
<span id="cb33-168"><a href="#cb33-168" tabindex="-1"></a><span class="co">#&gt;                              REF   character</span></span>
<span id="cb33-169"><a href="#cb33-169" tabindex="-1"></a><span class="co">#&gt;                              ALT        list</span></span>
<span id="cb33-170"><a href="#cb33-170" tabindex="-1"></a><span class="co">#&gt;                             QUAL     numeric</span></span>
<span id="cb33-171"><a href="#cb33-171" tabindex="-1"></a><span class="co">#&gt;                           FILTER        list</span></span>
<span id="cb33-172"><a href="#cb33-172" tabindex="-1"></a><span class="co">#&gt;                         INFO_END     integer</span></span>
<span id="cb33-173"><a href="#cb33-173" tabindex="-1"></a><span class="co">#&gt;      FORMAT_GT_test_deep_variant   character</span></span>
<span id="cb33-174"><a href="#cb33-174" tabindex="-1"></a><span class="co">#&gt;      FORMAT_GQ_test_deep_variant     integer</span></span>
<span id="cb33-175"><a href="#cb33-175" tabindex="-1"></a><span class="co">#&gt;      FORMAT_DP_test_deep_variant     integer</span></span>
<span id="cb33-176"><a href="#cb33-176" tabindex="-1"></a><span class="co">#&gt;  FORMAT_MIN_DP_test_deep_variant     integer</span></span>
<span id="cb33-177"><a href="#cb33-177" tabindex="-1"></a><span class="co">#&gt;      FORMAT_AD_test_deep_variant        list</span></span>
<span id="cb33-178"><a href="#cb33-178" tabindex="-1"></a><span class="co">#&gt;     FORMAT_VAF_test_deep_variant        list</span></span>
<span id="cb33-179"><a href="#cb33-179" tabindex="-1"></a><span class="co">#&gt;      FORMAT_PL_test_deep_variant        list</span></span>
<span id="cb33-180"><a href="#cb33-180" tabindex="-1"></a><span class="co">#&gt;  FORMAT_MED_DP_test_deep_variant     integer</span></span>
<span id="cb33-181"><a href="#cb33-181" tabindex="-1"></a><span class="co">#&gt; Parquet File Information: /tmp/tmp.2xxxp3kBwn.parquet </span></span>
<span id="cb33-182"><a href="#cb33-182" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-183"><a href="#cb33-183" tabindex="-1"></a><span class="co">#&gt; File size: 3.77 MB </span></span>
<span id="cb33-184"><a href="#cb33-184" tabindex="-1"></a><span class="co">#&gt; Total rows: 368319 </span></span>
<span id="cb33-185"><a href="#cb33-185" tabindex="-1"></a><span class="co">#&gt; Number of columns: 27 </span></span>
<span id="cb33-186"><a href="#cb33-186" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-187"><a href="#cb33-187" tabindex="-1"></a><span class="co">#&gt; Schema (top-level columns):</span></span>
<span id="cb33-188"><a href="#cb33-188" tabindex="-1"></a><span class="co">#&gt;                             name       type</span></span>
<span id="cb33-189"><a href="#cb33-189" tabindex="-1"></a><span class="co">#&gt;                            CHROM BYTE_ARRAY</span></span>
<span id="cb33-190"><a href="#cb33-190" tabindex="-1"></a><span class="co">#&gt;                              POS      INT64</span></span>
<span id="cb33-191"><a href="#cb33-191" tabindex="-1"></a><span class="co">#&gt;                               ID BYTE_ARRAY</span></span>
<span id="cb33-192"><a href="#cb33-192" tabindex="-1"></a><span class="co">#&gt;                              REF BYTE_ARRAY</span></span>
<span id="cb33-193"><a href="#cb33-193" tabindex="-1"></a><span class="co">#&gt;                              ALT       &lt;NA&gt;</span></span>
<span id="cb33-194"><a href="#cb33-194" tabindex="-1"></a><span class="co">#&gt;                             QUAL     DOUBLE</span></span>
<span id="cb33-195"><a href="#cb33-195" tabindex="-1"></a><span class="co">#&gt;                           FILTER       &lt;NA&gt;</span></span>
<span id="cb33-196"><a href="#cb33-196" tabindex="-1"></a><span class="co">#&gt;                         INFO_END      INT32</span></span>
<span id="cb33-197"><a href="#cb33-197" tabindex="-1"></a><span class="co">#&gt;      FORMAT_GT_test_deep_variant BYTE_ARRAY</span></span>
<span id="cb33-198"><a href="#cb33-198" tabindex="-1"></a><span class="co">#&gt;      FORMAT_GQ_test_deep_variant      INT32</span></span>
<span id="cb33-199"><a href="#cb33-199" tabindex="-1"></a><span class="co">#&gt;      FORMAT_DP_test_deep_variant      INT32</span></span>
<span id="cb33-200"><a href="#cb33-200" tabindex="-1"></a><span class="co">#&gt;  FORMAT_MIN_DP_test_deep_variant      INT32</span></span>
<span id="cb33-201"><a href="#cb33-201" tabindex="-1"></a><span class="co">#&gt;      FORMAT_AD_test_deep_variant       &lt;NA&gt;</span></span>
<span id="cb33-202"><a href="#cb33-202" tabindex="-1"></a><span class="co">#&gt;     FORMAT_VAF_test_deep_variant       &lt;NA&gt;</span></span>
<span id="cb33-203"><a href="#cb33-203" tabindex="-1"></a><span class="co">#&gt;      FORMAT_PL_test_deep_variant       &lt;NA&gt;</span></span>
<span id="cb33-204"><a href="#cb33-204" tabindex="-1"></a><span class="co">#&gt;  FORMAT_MED_DP_test_deep_variant      INT32</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p><a href="https://samtools.github.io/bcftools/" class="external-link">bcftools documentation</a></p></li>
<li><p><a href="https://github.com/samtools/bcftools" class="external-link">bcftools GitHub</a></p></li>
<li><p><a href="https://github.com/samtools/htslib" class="external-link">htslib GitHub</a></p></li>
<li><p><a href="https://arrow.apache.org/nanoarrow/" class="external-link">arrow-nanoarrow</a></p></li>
<li><p><a href="https://github.com/duckdb/ducklake/blob/main/examples/minio-demo-server/README.md" class="external-link">Ducklake minio Example</a></p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/RGenomicsETL/RBCFTools/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/RGenomicsETL/RBCFTools/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing RBCFTools</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Sounkou Mahamane Toure <br><small class="roles"> Author, maintainer </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/RGenomicsETL/RBCFTools/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/RGenomicsETL/RBCFTools/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://RGenomicsETL.r-universe.dev/RBCFTools" class="external-link"><img src="https://RGenomicsETL.r-universe.dev/RBCFTools/badges/version" alt="R-universe version"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sounkou Mahamane Toure.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
